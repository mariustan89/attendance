<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Your content goes here, like the QR scanner box -->

    <div id="reader"></div>

    <p>Worker ID: <span id="workerID"></span></p>

    <button onclick="clockInOut(document.getElementById('workerID').innerText)">Clock In/Out</button>

    <!-- Script goes here -->
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <script>
        window.onload = function() {
            console.log("Page Loaded. Starting QR scanner...");
            startQRScanner();
            loadAttendance();
        };

        function startQRScanner() {
            console.log("startQRScanner called");

            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert("Camera access is not supported on this browser.");
                console.log("Camera access is not supported.");
                return;
            }

            navigator.mediaDevices.getUserMedia({ video: true })
                .then(() => {
                    console.log("Camera permission granted");

                    let scanner = new Html5QrcodeScanner("reader", {
                        fps: 10,
                        qrbox: 250
                    });

                    scanner.render((decodedText) => {
                        console.log("QR code detected:", decodedText);
                        document.getElementById("workerID").innerText = decodedText;
                        scanner.clear(); // Stop scanner after scan
                        clockInOut(decodedText); // Automatically log attendance
                    });
                })
                .catch(err => {
                    alert("Camera permission denied. Enable it in Chrome settings.");
                    console.error("Camera error:", err);
                });
        }

        function clockInOut(workerID) {
            if (!workerID) {
                alert("No QR code detected!");
                return;
            }

            let now = new Date();
            alert(`Clocking in/out for Worker ID: ${workerID} at ${now}`);
        }

        async function loadAttendance() {
            console.log("Loading attendance...");
            // You can populate the attendance table here later if needed
        }
    </script>

</body>
</html>
